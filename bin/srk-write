#!/usr/bin/env python3
import subprocess, sys

stripeCards = [
    { "number": "4242 4242 4242 4242", "setup": True,  "3ds": False, "pay": True,                 },
    { "number": "4000 0000 0000 0341", "setup": True,  "3ds": False, "pay": False,                },
    { "number": "4000 0000 0000 9995", "setup": True,  "3ds": False, "pay": "insufficient_funds", },
    { "number": "4000 0000 0000 9987", "setup": True,  "3ds": False, "pay": "lost_card",          },
    { "number": "4000 0000 0000 9979", "setup": True,  "3ds": False, "pay": "stolen_card",        },
    { "number": "4000 0027 6000 3184", "setup": True,  "3ds": True,  "pay": True,                 },
    { "number": "4000 0082 6000 3178", "setup": True,  "3ds": True,  "pay": "insufficient_funds", },
    { "number": "4000 0535 6000 0011", "setup": False, "3ds": False, "pay": False,                }
]

def provideStripeCard():
    data = []
    for card in stripeCards:
        setup = "✔️" if card["setup"] else "❌"
        pay = ("✔️" if card["pay"] else "❌") if type(card["pay"]) is bool else "❌ " + card["pay"]
        _3ds = "⚠️" if card["3ds"] else ""

        data += [card["number"], setup, _3ds, pay]
    
    result = subprocess.run(["zenity", "--list",
        "--title=Stripe Card Picker",
        "--width=500",
        "--height=350",
        "--text=Pick a credit card",
        "--extra-button=More cards",
        "--column=Number", "--column=Setup", "--column=3DS", "--column=Pay",
        ] + data, stdout=subprocess.PIPE, text=True)
    
    if result.stdout == 'More cards\n':
        subprocess.run(["xdg-open", "https://stripe.com/docs/testing#cards"])
        exit(0)
    
    return result.stdout \
        .replace(" ", "") \
        .replace("\n", "")

providers = {
    "stripe-card": provideStripeCard
}

if len(sys.argv) > 1:
    provider = sys.argv[1]
    text = providers[provider]()
    subprocess.run(["xdotool", "type", "--delay", "100", text])
